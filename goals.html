<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khai's Goals</title>

    <script>
        // Register Service Worker for PWA support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
    
    <!-- React & ReactDOM (Loaded from CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- NO BABEL -->
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; }
        /* Hide number spinner */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Support (Apple doesn't use the manifest fully yet) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    
    <!-- Theme Color for Chrome/Android -->
    <meta name="theme-color" content="#F8FAFC">
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script>
        const { useState, useEffect, createElement } = React;
        const e = createElement;

        // --- INTERNAL ICON SYSTEM ---
        const Icon = ({ children, size = 24, className = "", ...props }) => {
            return e('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: size,
                height: size,
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className: className,
                ...props
            }, children);
        };

        const lucideReact = {
            Target: (props) => e(Icon, props, e('circle', { cx: 12, cy: 12, r: 10 }), e('circle', { cx: 12, cy: 12, r: 6 }), e('circle', { cx: 12, cy: 12, r: 2 })),
            TrendingUp: (props) => e(Icon, props, e('polyline', { points: "22 7 13.5 15.5 8.5 10.5 2 17" }), e('polyline', { points: "16 7 22 7 22 13" })),
            Layers: (props) => e(Icon, props, e('polygon', { points: "12 2 2 7 12 12 22 7 12 2" }), e('polyline', { points: "2 17 12 22 22 17" }), e('polyline', { points: "2 12 12 17 22 12" })),
            ListTodo: (props) => e(Icon, props, e('rect', { x: 3, y: 5, width: 6, height: 6, rx: 1 }), e('path', { d: "m3 17 2 2 4-4" }), e('path', { d: "M13 6h8" }), e('path', { d: "M13 12h8" }), e('path', { d: "M13 18h8" })),
            Award: (props) => e(Icon, props, e('circle', { cx: 12, cy: 8, r: 7 }), e('polyline', { points: "8.21 13.89 7 23 12 20 17 23 15.79 13.88" })),
            Minus: (props) => e(Icon, props, e('path', { d: "M5 12h14" })),
            Plus: (props) => e(Icon, props, e('path', { d: "M5 12h14" }), e('path', { d: "M12 5v14" }))
        };

        const { Target, TrendingUp, Layers, ListTodo, Award, Minus, Plus } = lucideReact;

        // --- COMPONENTS MOVED OUTSIDE ---

        const GoalCard = ({ label, value, inputValue, max, unit, onInputChange }) => (
            e('div', { className: "bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-3" },
                e('div', { className: "flex justify-between items-center mb-2" },
                    e('span', { className: "font-bold text-slate-700" }, label),
                    e('div', { className: "flex items-center gap-1 bg-slate-50 px-2 py-1 rounded-lg border border-slate-200" },
                        e('span', { className: "text-xs font-bold text-slate-400" }, unit),
                        e('input', {
                            type: "number",
                            value: inputValue,
                            onChange: (e) => onInputChange(e.target.value),
                            className: "w-20 text-right font-bold text-slate-700 bg-transparent outline-none p-0 m-0",
                            inputMode: "numeric"
                        }),
                        max && e('span', { className: "text-xs font-medium text-slate-400 ml-1" }, `/ ${max}`)
                    )
                ),
                max && e('div', { className: "h-3 bg-slate-100 rounded-full overflow-hidden mb-2 relative" },
                    e('div', {
                        className: "h-full bg-emerald-500 transition-all",
                        style: { width: `${Math.min(100, (value/max)*100)}%` }
                    })
                )
            )
        );

        const SkillSlider = ({ label, value, onChange }) => (
            e('div', { className: "mb-5" },
                e('div', { className: "flex justify-between text-xs font-bold text-slate-600 mb-2" },
                    e('span', null, label),
                    e('span', null, `${value}%`)
                ),
                e('div', { className: "flex items-center gap-3" },
                    e('button', {
                        onClick: () => onChange(Math.max(0, value - 1)),
                        className: "w-8 h-8 flex items-center justify-center bg-slate-100 rounded-lg text-slate-600 font-bold hover:bg-slate-200 active:scale-95 transition-all"
                    }, e(Minus, { size: 14 })),
                    e('div', { className: "flex-1 h-4 bg-slate-100 rounded-full overflow-hidden relative" },
                        e('div', {
                            className: "h-full bg-indigo-500 transition-all duration-300 ease-out",
                            style: { width: `${value}%` }
                        }),
                        e('input', {
                            type: "range",
                            min: 0,
                            max: 100,
                            value: value,
                            onChange: (e) => onChange(e.target.value),
                            className: "absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer"
                        })
                    ),
                    e('button', {
                        onClick: () => onChange(Math.min(100, value + 1)),
                        className: "w-8 h-8 flex items-center justify-center bg-slate-100 rounded-lg text-slate-600 font-bold hover:bg-slate-200 active:scale-95 transition-all"
                    }, e(Plus, { size: 14 }))
                )
            )
        );

        const GoalsApp = () => {
            
            const defaultGoals = {
                savings: 0,
                savingsTarget: 5000,
                skills: { frontend: 20, backend: 10, ai: 15 }
            };

            const [goals, setGoals] = useState(() => {
                const saved = localStorage.getItem('khaiGoals_v1');
                const savedData = saved ? JSON.parse(saved) : {};
                return {
                    savings: savedData.savings !== undefined ? savedData.savings : defaultGoals.savings,
                    savingsTarget: defaultGoals.savingsTarget,
                    skills: savedData.skills || defaultGoals.skills,
                };
            });

            const [savingInput, setSavingInput] = useState(String(goals.savings));

            useEffect(() => {
                localStorage.setItem('khaiGoals_v1', JSON.stringify(goals));
            }, [goals]);

            const updateSkill = (key, value) => {
                const cleanValue = Math.min(100, Math.max(0, parseInt(value) || 0));
                setGoals(prev => ({
                    ...prev,
                    skills: { ...prev.skills, [key]: cleanValue }
                }));
            };

            const handleSavingChange = (val) => {
                setSavingInput(val);
                if (val === '') return;
                const num = parseInt(val);
                if (!isNaN(num)) {
                    setGoals(prev => ({ ...prev, savings: num }));
                }
            };

            const pillars = [
                { id: 'focus', label: 'Focus', file: 'focus.html' },
                { id: 'clarity', label: 'Clarity', file: 'clarity.html' },
                { id: 'streak', label: 'Streak', file: 'streak.html' },
                { id: 'physical', label: 'Physical', file: 'physical.html' },
                { id: 'academic', label: 'Academic', file: 'academic.html' },
                { id: 'financial', label: 'Financial', file: 'financial.html' },
                { id: 'spiritual', label: 'Spiritual', file: 'spiritual.html' },
                { id: 'emotional', label: 'Emotional', file: 'emotional.html' },
            ];

            return e('div', { className: "min-h-screen font-sans pb-24" },
                e('div', { className: "bg-white shadow-sm sticky top-0 z-10" },
                    e('div', { className: "max-w-md mx-auto px-4 pt-4 pb-2" },
                        e('div', null,
                            e('h1', { className: "text-2xl font-black text-slate-800 tracking-tight" }, "Goal Board"),
                            e('p', { className: "text-slate-500 text-sm font-medium" }, "Vision & Progress")
                        )
                    )
                ),
                e('div', { className: "max-w-md mx-auto px-4 py-4 space-y-6" },
                    e('div', { className: "grid grid-cols-2 gap-2" },
                        pillars.map(pillar => 
                            e('a', {
                                key: pillar.id,
                                href: pillar.file,
                                className: "bg-white border border-slate-200 rounded-lg p-3 text-center text-sm font-bold text-slate-600 shadow-sm hover:border-indigo-300 hover:text-indigo-600 transition-colors block"
                            }, pillar.label)
                        )
                    ),
                    e(GoalCard, {
                        label: "Saving Goal",
                        unit: "RM ",
                        value: goals.savings,
                        inputValue: savingInput,
                        max: goals.savingsTarget,
                        onInputChange: handleSavingChange
                    }),
                    e('div', { className: "bg-white p-5 rounded-2xl shadow-sm border border-slate-100" },
                        e('h2', { className: "text-sm font-black text-slate-800 uppercase tracking-wider mb-4 flex items-center gap-2" },
                            e(Layers, { size: 16 }), " Skill Progression"
                        ),
                        e(SkillSlider, { label: "Front End Skill", value: goals.skills.frontend, onChange: (v) => updateSkill('frontend', v) }),
                        e(SkillSlider, { label: "Back End Skill", value: goals.skills.backend, onChange: (v) => updateSkill('backend', v) }),
                        e(SkillSlider, { label: "AI & Tools", value: goals.skills.ai, onChange: (v) => updateSkill('ai', v) })
                    )
                ),
                e('div', { className: "fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 p-2 z-50" },
                    e('div', { className: "max-w-md mx-auto flex justify-around" },
                        e('a', { href: "index.html", className: "flex flex-col items-center p-2 rounded-xl transition-all text-slate-400 hover:text-blue-600" },
                            e(ListTodo, { size: 24 }),
                            e('span', { className: "text-[10px] font-bold mt-1" }, "ROUTINE")
                        ),
                        e('button', { className: "flex flex-col items-center p-2 rounded-xl transition-all text-indigo-600 bg-indigo-50" },
                            e(Award, { size: 24 }),
                            e('span', { className: "text-[10px] font-bold mt-1" }, "GOALS")
                        )
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(e(GoalsApp));
    </script>


</body>
</html>